<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MSstatsWeightedSummary">
<title>Protein Quantification with Shared Peptides: Workflow • MSstatsWeightedSummary</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Protein Quantification with Shared Peptides: Workflow">
<meta property="og:description" content="MSstatsWeightedSummary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MSstatsWeightedSummary</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/shared_workflow.html">Protein Quantification with Shared Peptides: Workflow</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Protein Quantification with Shared Peptides: Workflow</h1>
            
      
      
      <div class="d-none name"><code>shared_workflow.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-statistical-model">Introduction: statistical model<a class="anchor" aria-label="anchor" href="#introduction-statistical-model"></a>
</h2>
<p>We will illustrate the proposed workflow for summarization of sets of
proteins with shared peptides.</p>
<p>Let us consider a group of <span class="math inline">\(K\)</span>
proteins that share peptides. For each spectral Feature <span class="math inline">\(f\)</span> we define the following set: <span class="math display">\[\begin{equation*}
    V(f) = \{k \in 1, \ldots, K: \text{ Feature f matches to Protein
k}\}
\end{equation*}\]</span> We propose the following model for
summarization: <span class="math display">\[\begin{multline}
    X_{cf} = \mu + \sum_{k \in V(f)}Weight_{fk}\left(Protein_k +
Channel_{kc}\right) + Feature_{f} + \varepsilon_{cf}, \\
    \forall_k \sum_{c = 1}^{C}Channel_{kc} = 0, \sum_{k =
1}^{K}Protein_k = 0, \sum_{f = 1}^{F} Feature_{f} = 0,
\mathbb{E}\varepsilon_{cf} = 0, \varepsilon_{cf}\, iid
%\stackrel{iid}{\sim} \mathcal{N}(0, \sigma^2)
\end{multline}\]</span> subject to the following constraints: <span class="math display">\[\begin{eqnarray*}
\forall_{f} \sum_{k \in V(k)}Weight_{fk} &amp;= 1, \\
\forall_{f, k} Weight_{fk} &amp;\geq 0,
\end{eqnarray*}\]</span> where <span class="math inline">\(X_{cf}\)</span> denotes the log-intensity of
Feature <span class="math inline">\(f\)</span> in Channel <span class="math inline">\(c\)</span>, <span class="math inline">\(Feature_{f}\)</span> is a fixed effect associated
with spectral features and <span class="math inline">\(\varepsilon_{cf}\)</span> denotes random error. As
the model is fitted for each Run <span class="math inline">\(mt\)</span>
separately, indices <span class="math inline">\(f\)</span> and <span class="math inline">\(c\)</span> should be understood as <span class="math inline">\(f(mt)\)</span> and <span class="math inline">\(c(mt)\)</span>, respectively. The sum of effects
<span class="math inline">\(\mu + Protein_k + Channel_{kc}\)</span>
describes the abundance of protein <span class="math inline">\(k\)</span> in channel <span class="math inline">\(c\)</span>. Parameter <span class="math inline">\(Protein_k\)</span> describes the baselines
abundance of <span class="math inline">\(k-th\)</span> protein, while
the term <span class="math inline">\(Channel_{kc}\)</span> allows us to
model the shape of protein-level profile. Thus, protein-level summary
for protein <span class="math inline">\(k\)</span> in Run <span class="math inline">\(mt\)</span> is given by <span class="math inline">\(\widehat{Y}_{kc} = \hat{\mu} +
\widehat{Protein}_{k} + \widehat{Channel}_{kc}\)</span>. Statistical and
implementation details can be found in accompying paper (see
<code>citation("MSstatsWeightedSummary")</code>). In short, the model is
fitted for each cluster of proteins separately via an iterative
procedure which alternates between fixing Weights and estimating other
effects, and estimating Weights while holding other parameters
fixed.</p>
</div>
<div class="section level2">
<h2 id="protein-summarization-workflow">Protein summarization workflow<a class="anchor" aria-label="anchor" href="#protein-summarization-workflow"></a>
</h2>
<p>First, let us load the required packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MSstatsWeightedSummary</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://msstats.org/msstatstmt/" class="external-link">MSstatsTMT</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="input-format-and-example-data">Input format and example data<a class="anchor" aria-label="anchor" href="#input-format-and-example-data"></a>
</h3>
<p>We will use the following simulated data set as an example:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">simulated_dataset</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">simulated_dataset</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ProteinName PeptideSequence Charge    PSM    Run Mixture TechRepMixture</span></span>
<span><span class="co">#&gt;         &lt;fctr&gt;          &lt;char&gt;  &lt;num&gt; &lt;char&gt; &lt;fctr&gt;  &lt;fctr&gt;         &lt;fctr&gt;</span></span>
<span><span class="co">#&gt; 1:   Prot_0001             P11      1  P11_1    1_1       1              1</span></span>
<span><span class="co">#&gt; 2:   Prot_0001             P11      1  P11_1    1_1       1              1</span></span>
<span><span class="co">#&gt; 3:   Prot_0001             P11      1  P11_1    1_1       1              1</span></span>
<span><span class="co">#&gt; 4:   Prot_0001             P11      1  P11_1    1_1       1              1</span></span>
<span><span class="co">#&gt; 5:   Prot_0001             P11      1  P11_1    1_1       1              1</span></span>
<span><span class="co">#&gt; 6:   Prot_0001             P11      1  P11_1    1_1       1              1</span></span>
<span><span class="co">#&gt;    Channel BioReplicate Condition Log2Intensity Intensity IsUnique</span></span>
<span><span class="co">#&gt;     &lt;fctr&gt;       &lt;fctr&gt;    &lt;fctr&gt;         &lt;num&gt;     &lt;num&gt;   &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1:       8          1_1         8      16.47425  91042.57     TRUE</span></span>
<span><span class="co">#&gt; 2:       7          1_1         7      16.75157 110338.30     TRUE</span></span>
<span><span class="co">#&gt; 3:       6          1_1         6      16.98772 129961.28     TRUE</span></span>
<span><span class="co">#&gt; 4:       5          1_1         5      17.03397 134194.66     TRUE</span></span>
<span><span class="co">#&gt; 5:       1          1_1         1      17.37219 169648.74     TRUE</span></span>
<span><span class="co">#&gt; 6:       2          1_1         2      17.32688 164403.55     TRUE</span></span>
<span><span class="co">#&gt;    log2IntensityNormalized AbundanceStandard</span></span>
<span><span class="co">#&gt;                      &lt;num&gt;             &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                16.47425       -0.59205067</span></span>
<span><span class="co">#&gt; 2:                16.75157       -0.31473021</span></span>
<span><span class="co">#&gt; 3:                16.98772       -0.07858202</span></span>
<span><span class="co">#&gt; 4:                17.03397       -0.03233669</span></span>
<span><span class="co">#&gt; 5:                17.37219        0.30588675</span></span>
<span><span class="co">#&gt; 6:                17.32688        0.26057756</span></span></code></pre></div>
<p>This data set contains some additional columns. Required input
consists of the same columns as MSstatsTMT format: ProteinName,
PeptideSequence, Charge, PSM, Run, Channel, Intensity, Condition,
BioReplicate, Mixture, TechRepMixture.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">required_input</span> <span class="op">=</span> <span class="va">simulated_dataset</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">ProteinName</span>, <span class="va">PeptideSequence</span>, <span class="va">Charge</span>, <span class="va">PSM</span>, <span class="va">Run</span>, </span>
<span>                           <span class="va">Channel</span>, <span class="va">Intensity</span>, <span class="va">Condition</span>, <span class="va">BioReplicate</span>,</span>
<span>                           <span class="va">Mixture</span>, <span class="va">TechRepMixture</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">required_input</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ProteinName PeptideSequence Charge    PSM    Run Channel Intensity Condition</span></span>
<span><span class="co">#&gt;         &lt;fctr&gt;          &lt;char&gt;  &lt;num&gt; &lt;char&gt; &lt;fctr&gt;  &lt;fctr&gt;     &lt;num&gt;    &lt;fctr&gt;</span></span>
<span><span class="co">#&gt; 1:   Prot_0001             P11      1  P11_1    1_1       8  91042.57         8</span></span>
<span><span class="co">#&gt; 2:   Prot_0001             P11      1  P11_1    1_1       7 110338.30         7</span></span>
<span><span class="co">#&gt; 3:   Prot_0001             P11      1  P11_1    1_1       6 129961.28         6</span></span>
<span><span class="co">#&gt; 4:   Prot_0001             P11      1  P11_1    1_1       5 134194.66         5</span></span>
<span><span class="co">#&gt; 5:   Prot_0001             P11      1  P11_1    1_1       1 169648.74         1</span></span>
<span><span class="co">#&gt; 6:   Prot_0001             P11      1  P11_1    1_1       2 164403.55         2</span></span>
<span><span class="co">#&gt;    BioReplicate Mixture TechRepMixture</span></span>
<span><span class="co">#&gt;          &lt;fctr&gt;  &lt;fctr&gt;         &lt;fctr&gt;</span></span>
<span><span class="co">#&gt; 1:          1_1       1              1</span></span>
<span><span class="co">#&gt; 2:          1_1       1              1</span></span>
<span><span class="co">#&gt; 3:          1_1       1              1</span></span>
<span><span class="co">#&gt; 4:          1_1       1              1</span></span>
<span><span class="co">#&gt; 5:          1_1       1              1</span></span>
<span><span class="co">#&gt; 6:          1_1       1              1</span></span></code></pre></div>
<p>There are three proteins in this data set. Each protein has one
unique peptide and shares multiple peptide with every other protein.</p>
</div>
<div class="section level3">
<h3 id="finding-protein-clusters">Finding protein clusters<a class="anchor" aria-label="anchor" href="#finding-protein-clusters"></a>
</h3>
<p>If output of signal processing tools lists all proteins that match to
a given protein, data should be converted to a format where each row
corresponds to a single observation of intensity by Protein, PSM, Run
and Channel. This means that shared peptides will appear multiple times
in the PSM table, once for each matching protein. If the output only
lists a single protein, <code>adjustProteinAssignments</code> function
can be used to add all candidate proteins via sequence matching. The
example data set already includes all possiblities.</p>
<p>This package provides tools for finding connected components of the
peptide-protein graph. Functions <code>createPeptideProteinGraph</code>
and <code>addClusterMembership</code> can be used to annotate the data
set with IDs of protein clusters, as illustrated below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pp_graph</span> <span class="op">=</span> <span class="fu"><a href="../reference/createPeptideProteinGraph.html">createPeptideProteinGraph</a></span><span class="op">(</span><span class="va">required_input</span><span class="op">)</span></span>
<span><span class="va">required_input</span> <span class="op">=</span> <span class="fu"><a href="../reference/addClusterMembership.html">addClusterMembership</a></span><span class="op">(</span><span class="va">required_input</span>, <span class="va">pp_graph</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">required_input</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">Cluster</span>, <span class="va">ProteinName</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;ProteinName&gt;</span></span>
<span><span class="co">#&gt;    Cluster ProteinName</span></span>
<span><span class="co">#&gt;      &lt;int&gt;      &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:       1   Prot_0001</span></span>
<span><span class="co">#&gt; 2:       1   Prot_0002</span></span>
<span><span class="co">#&gt; 3:       1   Prot_0003</span></span></code></pre></div>
<p>Functions <code>getClusterStatistics</code> and
<code>plotClusterStats</code> can be used to calculate and visualize
additional summary statistics such as counts of unique and shared
peptides in each cluster.</p>
</div>
<div class="section level3">
<h3 id="normalization">Normalization<a class="anchor" aria-label="anchor" href="#normalization"></a>
</h3>
<p>In the format with duplicated rows for shared peptides, normalization
requires care. To ensure that each feature intensity is used only once
for normalization, we provide a function called
<code>normalizeSharedPeptides</code>. This function performs
feature-level normalization of data previously implemented in MSstatsTMT
package. As a result, a column called
<code>log2IntensityNormalized</code> is added to the data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">simulated_dataset</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">ProteinName</span>, <span class="va">PSM</span>, <span class="va">Run</span>, <span class="va">Channel</span>, <span class="va">log2IntensityNormalized</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ProteinName    PSM    Run Channel log2IntensityNormalized</span></span>
<span><span class="co">#&gt;         &lt;fctr&gt; &lt;char&gt; &lt;fctr&gt;  &lt;fctr&gt;                   &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:   Prot_0001  P11_1    1_1       8                16.47425</span></span>
<span><span class="co">#&gt; 2:   Prot_0001  P11_1    1_1       7                16.75157</span></span>
<span><span class="co">#&gt; 3:   Prot_0001  P11_1    1_1       6                16.98772</span></span>
<span><span class="co">#&gt; 4:   Prot_0001  P11_1    1_1       5                17.03397</span></span>
<span><span class="co">#&gt; 5:   Prot_0001  P11_1    1_1       1                17.37219</span></span>
<span><span class="co">#&gt; 6:   Prot_0001  P11_1    1_1       2                17.32688</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="summarization">Summarization<a class="anchor" aria-label="anchor" href="#summarization"></a>
</h3>
<p>Protein-level summarization is the main functionality of this
package. We extend the MSstatsTMT workflow by jointly estimating the
abundance of all proteins in a given protein cluster. This is done via
an iterative procedure implemented in the
<code>getWeightedProteinSummary</code> function. This function requires
following input:</p>
<ul>
<li>
<code>feature_data</code>: input data in MSstatsTMT format. If
columns <code>Cluster</code> and <code>log2IntensityNormalized</code>
are not provided, clusters will be computed and the log-intensity column
will be added under the assumption that intensities have been
normalized,</li>
<li>
<code>norm</code>: norm for the residuals (objective function): can
be equal to “Huber” (Huber norm/loss) or “p_norm” (p-norm).</li>
<li>
<code>norm_parameter</code>: value of p parameter (for
<code>norm</code> = “p_norm”) or M parameter of Huber loss (for
<code>norm</code> = “Huber”).</li>
<li>
<code>weights_mode</code>: “contributions” or “probabilities”. The
former option constraints feature-protein weights to be non-negative and
sum to 1 for each feature, the latter option removes the “sum to 1”
condition, instead restricting weights to [0, 1] interval. Defaults to
“contributions”.</li>
<li>
<code>tolerance</code>: tolerance for differences between weights in
the iterative procedure.</li>
<li>
<code>max_iter</code>: maximum number of iterations of the iterative
fitting algorithm.</li>
<li>
<code>save_weights_history</code>: if TRUE, weights from each
iteration will be included in the output.</li>
<li>
<code>save_convergence_history</code>: if TRUE, differences between
weights from consecutive iterations will be included in the output.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary</span> <span class="op">=</span> <span class="fu"><a href="../reference/getWeightedProteinSummary.html">getWeightedProteinSummary</a></span><span class="op">(</span><span class="va">simulated_dataset</span>, norm <span class="op">=</span> <span class="st">"Huber"</span>,</span>
<span>                                    norm_parameter <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                    max_iter <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p>Output of this function is an object of class
“MSstatsWeightedSummary”. The next section explains how to access
elements of this object.</p>
<p>Two additional functions are provided for users who require more
customized workflow. Function <code>getPeptideProteinWeights</code>
calculates feature-protein weights for a given combination of
protein-level summary and feature-level data, while
<code>summarizeProteinsClusterSingleRun</code> estimates protein-level
data for a given set of weights and data from a single MS run.</p>
</div>
<div class="section level3">
<h3 id="diagnostics-and-plotting">Diagnostics and plotting<a class="anchor" aria-label="anchor" href="#diagnostics-and-plotting"></a>
</h3>
<p>Output of the <code>getWeightedProteinSummary</code> function is an
extension of the output of <code>proteinSummarization</code> from
MSstatsTMT. It includes the following elements:</p>
<ul>
<li>feature-level (input) data accessed with <code>featureData</code>
function,</li>
<li>protein-level (summary) data accessed with <code>proteinData</code>
function,</li>
<li>final feature-protein weights accessed with
<code>featureWeights</code> function,</li>
<li>information about convergence of the algorithm accessed with
<code>convergenceSummary</code> function,</li>
<li>optional history of convergence accessed with
<code>convergenceHistory</code> function,</li>
<li>optional history of weights accessed with
<code>weightsHistory</code> function.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/featureData.html">featureData</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span> <span class="co"># feature-level input data</span></span>
<span><span class="co">#&gt;    ProteinName PeptideSequence Charge    PSM Channel Intensity    Run Condition</span></span>
<span><span class="co">#&gt;         &lt;char&gt;          &lt;char&gt;  &lt;num&gt; &lt;char&gt;  &lt;fctr&gt;     &lt;num&gt; &lt;fctr&gt;    &lt;fctr&gt;</span></span>
<span><span class="co">#&gt; 1:   Prot_0001             P11      1  P11_1       8  91042.57    1_1         8</span></span>
<span><span class="co">#&gt; 2:   Prot_0001             P11      1  P11_1       7 110338.30    1_1         7</span></span>
<span><span class="co">#&gt; 3:   Prot_0001             P11      1  P11_1       6 129961.28    1_1         6</span></span>
<span><span class="co">#&gt; 4:   Prot_0001             P11      1  P11_1       5 134194.66    1_1         5</span></span>
<span><span class="co">#&gt; 5:   Prot_0001             P11      1  P11_1       1 169648.74    1_1         1</span></span>
<span><span class="co">#&gt; 6:   Prot_0001             P11      1  P11_1       2 164403.55    1_1         2</span></span>
<span><span class="co">#&gt;    BioReplicate Mixture TechRepMixture log2IntensityNormalized Cluster</span></span>
<span><span class="co">#&gt;          &lt;fctr&gt;  &lt;fctr&gt;         &lt;fctr&gt;                   &lt;num&gt;  &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:          1_1       1              1                16.47425  1__1_1</span></span>
<span><span class="co">#&gt; 2:          1_1       1              1                16.75157  1__1_1</span></span>
<span><span class="co">#&gt; 3:          1_1       1              1                16.98772  1__1_1</span></span>
<span><span class="co">#&gt; 4:          1_1       1              1                17.03397  1__1_1</span></span>
<span><span class="co">#&gt; 5:          1_1       1              1                17.37219  1__1_1</span></span>
<span><span class="co">#&gt; 6:          1_1       1              1                17.32688  1__1_1</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/proteinData.html">proteinData</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span> <span class="co"># output summary</span></span>
<span><span class="co">#&gt; Key: &lt;Run, Channel&gt;</span></span>
<span><span class="co">#&gt;       Run Channel   Protein Abundance Mixture TechRepMixture Condition</span></span>
<span><span class="co">#&gt;    &lt;fctr&gt;  &lt;char&gt;    &lt;char&gt;     &lt;num&gt;  &lt;fctr&gt;         &lt;fctr&gt;    &lt;fctr&gt;</span></span>
<span><span class="co">#&gt; 1:    1_1       1 Prot_0001  16.16886       1              1         1</span></span>
<span><span class="co">#&gt; 2:    1_1       1 Prot_0002  16.94093       1              1         1</span></span>
<span><span class="co">#&gt; 3:    1_1       1 Prot_0003  14.28871       1              1         1</span></span>
<span><span class="co">#&gt; 4:    1_1       2 Prot_0001  16.07184       1              1         2</span></span>
<span><span class="co">#&gt; 5:    1_1       2 Prot_0002  17.03870       1              1         2</span></span>
<span><span class="co">#&gt; 6:    1_1       2 Prot_0003  14.22520       1              1         2</span></span>
<span><span class="co">#&gt;    BioReplicate</span></span>
<span><span class="co">#&gt;          &lt;fctr&gt;</span></span>
<span><span class="co">#&gt; 1:          1_1</span></span>
<span><span class="co">#&gt; 2:          1_1</span></span>
<span><span class="co">#&gt; 3:          1_1</span></span>
<span><span class="co">#&gt; 4:          1_1</span></span>
<span><span class="co">#&gt; 5:          1_1</span></span>
<span><span class="co">#&gt; 6:          1_1</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/featureWeights.html">featureWeights</a></span><span class="op">(</span><span class="va">summary</span>, shared_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Weights</span></span>
<span><span class="co">#&gt;     ProteinName                           PSM    Run    Weight IsUnique</span></span>
<span><span class="co">#&gt;          &lt;char&gt;                        &lt;char&gt; &lt;fctr&gt;     &lt;num&gt;   &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt;  1:   Prot_0001 PS1Prot0001Prot0002Prot0003_1    1_1 0.0000000    FALSE</span></span>
<span><span class="co">#&gt;  2:   Prot_0002 PS1Prot0001Prot0002Prot0003_1    1_1 1.0000000    FALSE</span></span>
<span><span class="co">#&gt;  3:   Prot_0003 PS1Prot0001Prot0002Prot0003_1    1_1 0.0000000    FALSE</span></span>
<span><span class="co">#&gt;  4:   Prot_0001         PS1Prot0001Prot0002_1    1_1 0.3905934    FALSE</span></span>
<span><span class="co">#&gt;  5:   Prot_0002         PS1Prot0001Prot0002_1    1_1 0.6094066    FALSE</span></span>
<span><span class="co">#&gt;  6:   Prot_0001         PS1Prot0001Prot0003_1    1_1 0.5848836    FALSE</span></span>
<span><span class="co">#&gt;  7:   Prot_0003         PS1Prot0001Prot0003_1    1_1 0.4151164    FALSE</span></span>
<span><span class="co">#&gt;  8:   Prot_0002         PS1Prot0002Prot0003_1    1_1 0.5508112    FALSE</span></span>
<span><span class="co">#&gt;  9:   Prot_0003         PS1Prot0002Prot0003_1    1_1 0.4491888    FALSE</span></span>
<span><span class="co">#&gt; 10:   Prot_0001 PS2Prot0001Prot0002Prot0003_1    1_1 0.0000000    FALSE</span></span>
<span><span class="co">#&gt; 11:   Prot_0002 PS2Prot0001Prot0002Prot0003_1    1_1 0.7402802    FALSE</span></span>
<span><span class="co">#&gt; 12:   Prot_0003 PS2Prot0001Prot0002Prot0003_1    1_1 0.2597198    FALSE</span></span>
<span><span class="co">#&gt; 13:   Prot_0001         PS2Prot0001Prot0002_1    1_1 0.4577356    FALSE</span></span>
<span><span class="co">#&gt; 14:   Prot_0002         PS2Prot0001Prot0002_1    1_1 0.5422644    FALSE</span></span>
<span><span class="co">#&gt; 15:   Prot_0001         PS2Prot0001Prot0003_1    1_1 0.3429757    FALSE</span></span>
<span><span class="co">#&gt; 16:   Prot_0003         PS2Prot0001Prot0003_1    1_1 0.6570243    FALSE</span></span>
<span><span class="co">#&gt; 17:   Prot_0002         PS2Prot0002Prot0003_1    1_1 0.5983119    FALSE</span></span>
<span><span class="co">#&gt; 18:   Prot_0003         PS2Prot0002Prot0003_1    1_1 0.4016881    FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/convergenceSummary.html">convergenceSummary</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Cluster    Run NumIterations FinalDiffValue tolerance Converged</span></span>
<span><span class="co">#&gt;     &lt;char&gt; &lt;char&gt;         &lt;int&gt;          &lt;num&gt;     &lt;num&gt;    &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1:  1__1_1    1_1             7     0.09036566       0.1      TRUE</span></span></code></pre></div>
<p>Summary can be plotted for a given cluster or set of proteins using
<code>plotSummary</code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSummary.html">plotSummary</a></span><span class="op">(</span><span class="va">summary</span>, cluster <span class="op">=</span> <span class="st">"1__1_1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="shared_workflow_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>It is also possible to obtain protein cluster information via
<code>proteinClusters</code> function.</p>
</div>
<div class="section level3">
<h3 id="msstatstmt-workflow">MSstatsTMT workflow<a class="anchor" aria-label="anchor" href="#msstatstmt-workflow"></a>
</h3>
<p>Function <code>makeMSstatsTMTInput</code> can be used to convert
output of summarization to a format suitable for use with the
<code>groupComparisonTMT</code> function. Optional parameter
<code>msstatstmt_output</code> can be provided to merge output of
<code>proteinSummarization</code> with shared peptides-based
summary.</p>
<p>Currently, since protein-level normalization is done in the
proteinSummarization step of MSstats workflow, it is not possible to use
“Norm” Channel to jointly normalize output of unique-peptide based
summarization (done with MSstatsTMT) and cluster summarization (done
with MSstatsWeightedSummary) using functionalities of either of the
packages. We intend to add this feature in the future.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gc_input</span> <span class="op">=</span> <span class="fu"><a href="../reference/makeMSstatsTMTInput.html">makeMSstatsTMTInput</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">gc_input</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ FeatureLevelData:Classes 'data.table' and 'data.frame':   168 obs. of  13 variables:</span></span>
<span><span class="co">#&gt;   ..$ ProteinName            : chr [1:168] "Prot_0001" "Prot_0001" "Prot_0001" "Prot_0001" ...</span></span>
<span><span class="co">#&gt;   ..$ PeptideSequence        : chr [1:168] "P11" "P11" "P11" "P11" ...</span></span>
<span><span class="co">#&gt;   ..$ Charge                 : num [1:168] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ PSM                    : chr [1:168] "P11_1" "P11_1" "P11_1" "P11_1" ...</span></span>
<span><span class="co">#&gt;   ..$ Channel                : Factor w/ 8 levels "1","2","3","4",..: 8 7 6 5 1 2 3 4 1 2 ...</span></span>
<span><span class="co">#&gt;   ..$ Intensity              : num [1:168] 91043 110338 129961 134195 169649 ...</span></span>
<span><span class="co">#&gt;   ..$ Run                    : Factor w/ 1 level "1_1": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ Condition              : Factor w/ 8 levels "1","2","3","4",..: 8 7 6 5 1 2 3 4 1 2 ...</span></span>
<span><span class="co">#&gt;   ..$ BioReplicate           : Factor w/ 1 level "1_1": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ Mixture                : Factor w/ 1 level "1": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ TechRepMixture         : Factor w/ 1 level "1": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ log2IntensityNormalized: num [1:168] 16.5 16.8 17 17 17.4 ...</span></span>
<span><span class="co">#&gt;   ..$ Cluster                : chr [1:168] "1__1_1" "1__1_1" "1__1_1" "1__1_1" ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; </span></span>
<span><span class="co">#&gt;   ..- attr(*, "index")= int(0) </span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "__Cluster")= int(0) </span></span>
<span><span class="co">#&gt;  $ ProteinLevelData:Classes 'data.table' and 'data.frame':   24 obs. of  8 variables:</span></span>
<span><span class="co">#&gt;   ..$ Run           : Factor w/ 1 level "1_1": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ Channel       : chr [1:24] "1" "1" "1" "2" ...</span></span>
<span><span class="co">#&gt;   ..$ Protein       : chr [1:24] "Prot_0001" "Prot_0002" "Prot_0003" "Prot_0001" ...</span></span>
<span><span class="co">#&gt;   ..$ Abundance     : num [1:24] 16.2 16.9 14.3 16.1 17 ...</span></span>
<span><span class="co">#&gt;   ..$ Mixture       : Factor w/ 1 level "1": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ TechRepMixture: Factor w/ 1 level "1": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ Condition     : Factor w/ 8 levels "1","2","3","4",..: 1 1 1 2 2 2 3 3 3 4 ...</span></span>
<span><span class="co">#&gt;   ..$ BioReplicate  : Factor w/ 1 level "1_1": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; </span></span>
<span><span class="co">#&gt;   ..- attr(*, "sorted")= chr [1:2] "Run" "Channel"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "index")= int(0) </span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "__Protein")= int [1:24] 1 4 7 10 13 16 19 22 2 5 ...</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Contrasts matrix</span></span>
<span><span class="va">cm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>              <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>              <span class="fl">0</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>,</span>
<span>              <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>            byrow <span class="op">=</span> <span class="cn">TRUE</span>, ncol <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cm</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">cm</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="st">"vs"</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">gc_output</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MSstatsTMT/man/groupComparisonTMT.html" class="external-link">groupComparisonTMT</a></span><span class="op">(</span><span class="va">gc_input</span>, <span class="va">cm</span>, use_log_file <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; INFO  [2024-09-17 12:03:01] Design: 1 mixture.</span></span>
<span><span class="co">#&gt; INFO  [2024-09-17 12:03:01] Design: 1 MS run per mixture.</span></span>
<span><span class="co">#&gt; INFO  [2024-09-17 12:03:01] Design: 1 subject per condition (No biological variation).</span></span>
<span><span class="co">#&gt; INFO  [2024-09-17 12:03:01] Model fitting for 3 proteins.</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span><span class="co">#&gt; INFO  [2024-09-17 12:03:01] Testing for 3 proteins:</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span><span class="va">gc_output</span><span class="op">$</span><span class="va">ComparisonResult</span></span>
<span><span class="co">#&gt;       Protein  Label      log2FC    SE    DF pvalue adj.pvalue</span></span>
<span><span class="co">#&gt;        &lt;fctr&gt; &lt;char&gt;       &lt;num&gt; &lt;num&gt; &lt;num&gt;  &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1: Prot_0001 1 vs 5 -0.32302748   NaN     0    NaN        NaN</span></span>
<span><span class="co">#&gt;  2: Prot_0001 2 vs 6 -0.28129458   NaN     0    NaN        NaN</span></span>
<span><span class="co">#&gt;  3: Prot_0001 3 vs 7 -0.41480253   NaN     0    NaN        NaN</span></span>
<span><span class="co">#&gt;  4: Prot_0001 4 vs 8 -0.85946263   NaN     0    NaN        NaN</span></span>
<span><span class="co">#&gt;  5: Prot_0002 1 vs 5 -0.12743993   NaN     0    NaN        NaN</span></span>
<span><span class="co">#&gt;  6: Prot_0002 2 vs 6 -0.40505177   NaN     0    NaN        NaN</span></span>
<span><span class="co">#&gt;  7: Prot_0002 3 vs 7 -0.33734986   NaN     0    NaN        NaN</span></span>
<span><span class="co">#&gt;  8: Prot_0002 4 vs 8 -0.26747381   NaN     0    NaN        NaN</span></span>
<span><span class="co">#&gt;  9: Prot_0003 1 vs 5  0.06348433   NaN     0    NaN        NaN</span></span>
<span><span class="co">#&gt; 10: Prot_0003 2 vs 6  0.16007991   NaN     0    NaN        NaN</span></span>
<span><span class="co">#&gt; 11: Prot_0003 3 vs 7 -0.19260057   NaN     0    NaN        NaN</span></span>
<span><span class="co">#&gt; 12: Prot_0003 4 vs 8  0.03574476   NaN     0    NaN        NaN</span></span>
<span><span class="co">#&gt;                         issue</span></span>
<span><span class="co">#&gt;                        &lt;char&gt;</span></span>
<span><span class="co">#&gt;  1: SingleMeasurePerCondition</span></span>
<span><span class="co">#&gt;  2: SingleMeasurePerCondition</span></span>
<span><span class="co">#&gt;  3: SingleMeasurePerCondition</span></span>
<span><span class="co">#&gt;  4: SingleMeasurePerCondition</span></span>
<span><span class="co">#&gt;  5: SingleMeasurePerCondition</span></span>
<span><span class="co">#&gt;  6: SingleMeasurePerCondition</span></span>
<span><span class="co">#&gt;  7: SingleMeasurePerCondition</span></span>
<span><span class="co">#&gt;  8: SingleMeasurePerCondition</span></span>
<span><span class="co">#&gt;  9: SingleMeasurePerCondition</span></span>
<span><span class="co">#&gt; 10: SingleMeasurePerCondition</span></span>
<span><span class="co">#&gt; 11: SingleMeasurePerCondition</span></span>
<span><span class="co">#&gt; 12: SingleMeasurePerCondition</span></span></code></pre></div>
<!-- plotDistributionComparison Compare distribution of log2-intensities per channel with and without shared peptides -->
<!-- plotProfiles   Plot feature profiles -->
<!-- plotSummaryComparison  Plot multiple protein-level summaries -->
<!-- getWeightsConstraints  Get constraints for weights : remove help? -->
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mateusz Staniak.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
